<!DOCTYPE html>
<html>
    <head lang="en">
        <link rel="icon" href="../favicon.ico"/>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Accessibility Chatbot</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <link rel="stylesheet" href="./style.css" type="text/css">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
        <style type="text/css">     
       .container{
        width: 60%;
        margin-bottom: 20px;
       }
       .fixed-panel {
            min-height: 400px;
            max-height: 400px;
            background-color: #19313ce6;
            color: White;
            overflow: auto;
        }
        .logo {
            display: inline-block;
            margin: 15px;
            float: left;
            height: 60px;
            width: auto;
            border-radius: 10%;
          }
        .nav {
            float: right;
            padding: 35px 20px 20px 0;
          }
        .menu-icon {
            display: inline-block;
            width: 50px;
            height: 60px;
            background: <a href="http://tinypic.com?ref=261kfht" target="_blank">     <img src="http://i68.tinypic.com/261kfht.jpg" border="0" alt="Image and video hosting by TinyPic"></a> center;
          }
        .media-list {
            overflow: auto;
            clear: both;
            display: table;
            overflow-wrap: break-word;
            word-wrap: break-word;
            word-break: normal;
            line-break: strict;
        }
        .media-list li{
            color: lightgray;
        }
        .panel {
            margin-bottom: 20px;
            background-color: #fff;
            border: 6px solid transparent;
            border-radius: 25px;
            -webkit-box-shadow: 0 1px 1px rgba(0,0,0,.05);
            box-shadow: 0 1px 1px rgba(0,0,0,.05);
        }
        .panel-body{
            padding:2% 10%;
            height: 250px;
            background-color: #19313c;
        }
        .panel-info {
            border-color: #0c2735;
        }
        .panel-info>.panel-heading {
            text-align: center;
            font-size: 18px;
            font-weight: 200;
            color: orange;
            background-color: #0c2735;
            border-color: #0c2735;
        }
        .panel-footer {
            width: 100%;
            height: 80px;
            padding: 20px auto;
            background-color: #0c2735;
            border-top: 1px solid #0c2735;
            border-bottom-right-radius: 3px;
            border-bottom-left-radius: 3px
        }
        .input-group{
            width: 75%;
            margin: auto;
        }
        html{
            background-color: lightgray;
        }
        .overflow{
            overflow: hidden;
            overflow-y: scroll;
        }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="row">
              <div>
                    <div id="chatPanel" class="panel panel-info">
                        <div class="panel-heading">
                            <strong><span class="glyphicon glyphicon-globe"></span> Query Your Requests !!!  </strong> <!-- (You: Green / ChatBot: White) -->
                        </div>
                        <div class="panel-body overflow">
                            <ul class="media-list">
                            </ul>
                        </div>
                        <div class="panel-footer">
                            <form method="post" id="chatbot-form">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="Enter Message" name="messageText" id="messageText" autofocus/>
                                    <span class="input-group-btn">
                                        <button style="margin: 0% 15%;" class="btn btn-info btnbackground" type="button" id="chatbot-form-btn">Send</button>
                                        <button  class="btn btn-info btnbackground" type="button" id="chatbot-form-btn-clear">Clear</button>
                                    </span>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script>
            var exports = {};
        </script>
        <script src="https://unpkg.com/speech-to-text@0.7.4/lib/index.js"></script>
        <script>
        $(function() {
            var synth = window.speechSynthesis;

            var msg = new SpeechSynthesisUtterance();
            var voices = synth.getVoices();
            msg.voice = voices[0];
            msg.rate = 1;
            msg.pitch = 1;
            var apiCal = false;

            $('#chatbot-form-btn').click(function(e) {
                e.preventDefault();
                $('#chatbot-form').submit();
            });
            $('#chatbot-form-btn').click(function(e){
                if($.trim($('#messageText').val()) == ''){
                  alert('Please provide input for querying Accessibility');
                  apiCal = true;
                  console.log("apiCal:"+apiCal);
                  //$(document).ready(function(){
                  //location.reload(true);
                    //});
                }else{
                  apiCal = false;
                  console.log("apiCal:"+apiCal);
                }
              });

            $('#chatbot-form-btn-clear').click(function(e) {
                e.preventDefault();
                $('#chatPanel').find('.media-list').html('');
            });
            $('#chatbot-form-btn-voice').click(function(e) {
                e.preventDefault();

                var onAnythingSaid = function (text) {
                    console.log('Interim text: ', text);
                };
                var onFinalised = function (text) {
                    console.log('Finalised text: ', text);
                    $('#messageText').val(text);
                };
                var onFinishedListening = function () {
                     $('#chatbot-form-btn').click();
                };

                //try {
                  //  var listener = new SpeechToText(onAnythingSaid, onFinalised, onFinishedListening);
                    //listener.startListening();

                    //setTimeout(function () {
                      //  listener.stopListening();
                        //if ($('#messageText').val()) {
                          //  $('#chatbot-form-btn').click();
                        //}
                    //}, 5000);
                //} catch (error) {
                //    console.log(error);
                //}
            $});


            $('#chatbot-form').submit(function(e) {
                e.preventDefault();
                if($.trim($('#messageText').val()) != ''){
                  var message = $('#messageText').val();
                        $(".media-list").append('<li class="media"><div class="media-body"><div class="media"><div style = "text-align:right; color : #2EFE2E" class="media-body">' + message + '<hr/></div></div></div></li>');

                        //var inputString = {input : message};
                        //console.log(inputString);
                        const data = {input : message,API_KEY : 940543678};
                        //print(data);
                        console.log("before api method call:"+apiCal);
                        console.log("message :"+message);
                        apiCal = false;
                        if(!apiCal){
                        $.ajax({
                            type: "POST",
                            url: "/get-response",
                            headers :{
                                "Content-Type" : "application/json"
                            },
                            data: JSON.stringify(data),
                            success: function(response) {
                                console.log(response);
                                $('#messageText').val('');
                                var answer = response.response;
                                const chatPanel = document.getElementById("chatPanel");
                                $(".media-list").append('<li class="media"><div class="media-body"><div class="media"><div style = "color : white" class="media-body">' + answer + '<hr/></div></div></div></li>');
                            },
                            error: function(error) {
                                console.log(error);
                            }
                        });
                      }
                    }
                    else{
                      apiCal = false;
                      }
                    });

        });
        </script>
        <!--<footer>
          <section>
          <h3><b> Me</b></h3>
          <p><b>@iamdpk@gmail.com</b><br><br>
          contact me if you want to send me pictures to post on my Instagram or Twitter.</p>
          </section>
          <section>
          <h3>Follow me!</h3>
          <ul class="social">
          <li><a href="www.online-instagram.com/user/i_see_st4irs/246253528"><img src="instagram_logo_small.png"></a></li>
          <li><a href="https://twitter.com/i_see_st4irs"><img src="twitter.png"></a></li>
          <li><a href="https://twitter.com/i_see_st4irs"><img src="tumblr.png"></a></li>
          <li><a href="https://plus.google.com/wm/quevuelvamatt/.../collections"><img src="googleplus.png"></a></li>
          <li><a href="https://www.youtube.com/channel/UCOaUXzGUZ2_1EB_-QI15WoA"><img src="youtube.png"></a></li>
          </ul>
          </section>
          <section>
          <img src="logo.jpg">
          </section>
          </footer>
          <footer class="second">
          <p>Â©copyright - I_See_St4irs, 2016.</p>
        </footer> -->
    </body>
</html>
